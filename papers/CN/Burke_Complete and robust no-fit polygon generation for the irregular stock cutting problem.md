# 论文标题

参考论文：Burke E K, Hellier R S R, Kendall G, et al. Complete and robust no-fit polygon generation for the irregular stock cutting problem[J]. European Journal of Operational Research, 2007, 179(1): 27-49.

不规则下料问题中的完全的鲁棒的临界多边形生成

# 摘要

临界多边形是一种可以在成对的形状之间使用的构造方式，用于快速有效地处理不规则二维下料问题中的几何形状。以前，临界多边形（No-Fit Polygon，NFP）未能得到广泛的应用是因为缺乏处理所有问题的通用方案，而不是只能针对某个具体的需求。本文介绍了一种稳健的轨道方法用于创建临界多边形，而且不会受到文献中其他方法遇到的典型问题。此外，这个算法只包含两个简单的几何过程，因此易于理解与实现。我们演示了该方法如何处理已知的退化情况，例如：孔洞、互锁凹面、锯齿类型的块，并且在文献中给出了32个不规则排样基准问题的生成时间，包括了真实世界的数据集，以便与现有的和未来的方法进一步比较。

## 关键词

切割，排样，临界多边形，轨道方法

# Ch01 介绍

切割与排样问题的二维不规则变体影响了许多重要的制造业，如：纺织、塑料、金属切割等等。这些问题通常面对的是如何将许多不规则的零件以最有效的布局放置在一张或者多张材料上，以便所有零件都被指定，并且不会重叠。此外，由于问题的物理性质，例如：材质上的纹理、纺织品上的图案和所采用的切割技术，通常会对工件增加旋转约束。有些时候这类约束可以被用在非物理原因中，例如：将零件限制在有限的旋转集合中，从而简化布局的构建过程，并且允许获得更快的解决方案。二维下料问题已经被证明是NP难问题，因此本质上是很难解决的（Garey and Johnson, 1979）。有这么多不同的策略来解决不规则的块切割问题。这些方法包括线性规划方法、启发式布局方法、元启发式引导搜索技术和其他新颖的方法。例如：零件迭代挤压（Dowsland et al., 1998）。综述论文可见（Dowsland and Dowsland, 1992; Sweeney and Paternoster, 1992; Dyckhoff, 1990）。然而，连接所有方法的特征是它们都需要处理问题的几何开关。当使用高度不规则的形状（可能包括孔洞或者凹面）时，这可能特别复杂。鲁棒的并且有效的几何方法的实现可能是费力的，并且可能需要花费的时间比排样策略还多。具体来说，几何图形必须处理形状之间的所有交互，例如：检测两个形状是否重叠，并且计算沿给定方向所需要的移动距离，用于解决重叠问题。正如我们在下一节中所展示的，虽然这些检测可以使用三角函数来实现，但是临界多边形展现了一个更有效的解决方案。

在学术上，虽然临界多边形的生成具有挑战性，但它只是一个“工具”而不是“解决方案”，这可能是文献中这么多出版物在声明中使用临界多边形，但是在实现上只提供了很少的细节。在本文中，我们特别关注在临界多边形，并且提供了对历史技术的概述，以便用于形状的创建。此外，我们描述并且提供了实现一种新的鲁棒的轨道方法的全部细节，这种方法可以解决其他方法无法处理的传统问题。希望这将帮助进一步传播使用临界多边形的优势（相比于传统的三角函数方法）。

# Ch02 临界多边形——概述

在本节中，我们描述了临界多边形的功能，并且将其与传统的基于三角函数的重叠和相交测试进行了比较。我们还简要概述了以前的文献中用于生成临界多边形的许多技术。

## 2.1 临界多边形

在切割和排样领域领域，Art(1996)首次提出了临界多边形技术，尽管使用的术语是“形状包络”。十年后，Adamowicz 和 Albano 提出了术语“临界多边形”，并且基于临界多边形将形状使用最小封闭矩形打包在一起来解决不规则的原料分割问题。术语“构型空间障碍”通常在工程或者机器人运动规划领域用于表示NFP，但是这个术语也被用于切割和排样（Cuninghame-Green, 1989）。“速度图”经常在数学界用于描述临界多边形（Stoyan 和 Ponomaarenko, 1977; Scheithauer 和 Terno, 1993; Bennell 等, 2001）。临界多边形的主要功能是描述两个多边形的相差区域。下面的示例概述了NFP的构造。

给定两个多边形：$A$和$B$，一个形状可以通过环绕另一个形状的边界来寻找临界多边形。其中一个多边形的位置保持固定，另一个多边形沿着固定多边形的边缘遍历，同时确保两个多边形始终接触但是从不相交。在本文中，我们采用了第一个多边形是固定的，第二个多边形是移动或者环绕多边形。因此，当多边形$B$沿着固定多边形$A$勾勒轮廓时，输出的临界多边形记为$NFP_{AB}$。为了创建$NFP_{AB}$对象，我们必须从$B$中选择一个参考点，当$B$环绕$A$时参考点将被跟踪。在实现中，我们使用形状的顶点列表中的第一个顶点作为参考点（见图1）。参考点可以是任何点，只要它能够跟随环绕多边形支行。保持参考点相对于多边形$B$的相对位置也很重要，因为NFP测试重叠时需要使用。

![image-20210907174620387](Burke_Complete and robust no-fit polygon generation for the irregular stock cutting problem.assets/image-20210907174620387.png)

图1：两个形状$A$和$B$的临界多边形

为了测试多边形$B$是否与多边形$A$重叠，我们使用了$NFP_{AB}$和$B$的参考点。如果多边形$B$的位置使其参考点位于多边形$NFP_{AB}$的内部，则其与多边形$A$重叠。如果多边形$B$的参考点在$NFP_{AB}$的边界上，则其与多边形$A$接触。如果多边形$B$的参考点在$NFP_{AB}$的外部，则其与多边形$A$没有重叠与接触（见图2）。文献中以下论文（Grinde 和 Cavalier, 1995; Ramkumar, 1996; Cheng 和 Rao, 1997; Dowsland 等, 1998, 2002; Milenkovic, 1999; Gomes 和 Oliveira, 2002）使用了临界多边形。

![image-20210907175350469](Burke_Complete and robust no-fit polygon generation for the irregular stock cutting problem.assets/image-20210907175350469.png)

图2：在多边形$A$和$B$之间使用临界多边形检测相交性

## 2.2 在重叠检测上对比临界多边形与标准三角几何

尽管临界多边形是成对多边形之间进行相交检测的优秀工具，但是在文献与现实世界的制造产业中，它还没有被广泛应用到二维排料问题中。毫无疑问，这是因为临界多边形的实现困难与缺乏可用的鲁棒的算法。相反，许多相交的实现使用标准的三角几何方法，特别是，这种方法出现实际应用的排料软件中，在这种情况下，分布式软件能够完全正确地处理所有可能的多边形就显得极为重要。然而，这两种方法虽然它们的总体效果相同，但是使用临界多边形的程序会比效率最高的三角几何的程序还要快好几倍。例如：我们希望尝试同一布局问题的多次迭代，预生成的临界多边形可以显著减少总计算时间。在多次迭代中，在重复的方向和位置上，三角几何方法可能会重复检测和解析相同的重叠形状。当一个排料的重叠解析方法需要计算两个相交形状的所有相交点时，临界多边形方法的优势将进一步增强，因为当使用三角几何方法时，为了满足检测冲突的需要，将会执行大量的相关计算。因此，通过使用临界多边形，我们可以将重叠检测问题（这是排料过程中影响计算的主要因素）的计算成本减少不对劲多边形检测中成本明显较低的点上（Dowsland 等, 2002）。除此之外，当 Burke 等人使用重叠分辨技术时（待出版），通过重复分辨y轴方向上的相交边来分辨相交形状，通过使用临界多边形的分辨技术将 更加有效，在一次完整的移动中就可以解析y轴上的重叠。此外，临界多边形还允许在任意方向上通过从相关的参考点投射出一条射线，并且找到与临界多边形边界最近的交点来解决重叠问题。在下一节中，我们比较了用于检测和解决两个多边形之间重叠问题的几何过程，首先，使用标准三角几何，其次，使用临界多边形（NFP）。给定一个排料方法，假设多边形$A$有$7$条边，多边形$B$有$6$条边，我们希望检测两个多边形$A$和$B$的所有交点（见图3），因此每条边都会与其他的边进行检测，共进行42次检测用于确定相交的状态。此外，如果我们没有找到相交点，为了消除两个多边形穿过顶点相交的可能性，我们必须对两个形状上的所有点执行点内检测，这一共需要13次检测，因此在最坏的情况下总共需要55次检测。

![image-20210908105947567](Burke_Complete and robust no-fit polygon generation for the irregular stock cutting problem.assets/image-20210908105947567.png)

图3：使用临界多边形实现的相交性检测

对于通过三角几何方法检测布局中任意两个多边形之间的交集，以上这些检测可以被视为一个很大但是不可避免的开销，而且开销会随着多边形数量的增加而变大。虽然可以尝试许多搜索方法，还可以开发快速的次库，但是交集检测仍然是生成排料解时计算开销的相当大的一部分。此外，当我们希望使用搜索方法来开发大量的解决方案时，这些经常重复性的计算将对整体的计算时间产生相当大的影响。

现在回到图3，两个多边形的临界多边形$NFP_{AB}$也显示在问题空间的某个任意位置。在这种情况下，使用提出的“边滑动”技术生成的$NFP_{AB}$，其中多边形$B$穿过多边形$A$上的边，并且通过穿过多边形的参考点$REF_B$来形成$NFP$。在创建NFP的笛卡尔空间中的坐标不会影响基于相交检测来使用$NFP$，因为我们可以基于参考点，简单地根据$NFP$的位置生成正确的检测点（test point, tp）：$tp=REF_{NFP_{AB}}+REF_B-REF_A- Offset$，其中$Offset$是从多边形$A$（固定多边形）的参考点到临界多边形（$REF_{NFP_{AB}}-REF_{A}$）的参考点的向量。关于$NFP_{AB}$检测点（tp）的状态可以使用 O'Rourke(1998) 中描述的射线交叉算法计算。如果检测点（tp）在$NFP_{AB}$内，则多边形$A$和$B$相互发生碰撞。碰撞意味着两个多边形相交或者一个多边形在另一个内部。如果检测点（tp）在$NFP_{AB}$上，则两个多边形接触。如果检测点（tp）在$NFP_{AB}$外，则两个多边形既没有接触也没有碰撞。通过计算所有的成对多边形的全部临界多边形，当执行多重迭代排样时，我们可以显著地节省计算时间。

## 2.3. 构造临界多边形的方法

这里，我们通过文献回顾了以往用于构建临界多边形的主要技术。对于每种方法，我们都做了简要的概述，并且讨论了使用这个方法的可能出现的任何优点和缺点。

### 2.3.1. 凸多边形

两个多边形都是凸多边形是临界多边形生成的基本形式。给定两个凸多边形$A$和$B$，通过以下步骤创建临界多边形：❶逆时针确定形状$A$的方向，顺时针确定形状$B$的方向（见图4a）；❷将$A$和$B$的所有边移动到一个点（见图4b）；❸沿逆时针顺序连接这些边产生临界多边形（见图4c）。

Cuninghame-Green使用这种方法在凸多边形对之间产生“构型空间障碍”，然后形状排列中将之用于相交检测（Cuninghame-Green, 1989）。对于包括非凸多边形的实例，Cuninghame-Green首先计算每个非凸形状的凸包（包含凸多边形的最小值），然后使用各自的凸包计算临界多边形。

凸的临界多边形生成是结合使用标准排序算法和平移后的边再排序，其优点是简单、速度快。明显的缺点是对于非凸的形状无法生成对应的临界多边形，并且凸包的简化导致凸的部分在排料中是无效的，在机器人运动规划中是不可穿越的。因为这会对解决方案的质量产生不利的影响，所以需要其他方法。

### 2.3.2. 非凸多边形

存在许多不同的方法从非凸形状中生成临界多边形。这些设计方法可以分为三大类：分解、Minkowski 和 与轨道方法。

#### 2.3.2.1 分解

第一种方法是将任何非凸形状分解成更容易“管理”的子块。然而，分解通常会出现多个子块，因此必须创建多个临界多边形。为了进行相交检测，临界多边形可以保持分解的状态，或者通过并集操作组合在一起。在可能的情况下，单个临界多边形提供了最快的相交计算时间，但是还需要额外的计算来重组组成的成分。如果存在几个子部分，那么这个计算任务就会变得昂贵且困难。如果还有孔洞，那么任务可能会更加复杂。例如：Agarwal等人(2002)对不同的涉及构造非凸多边形的“Minkowski和”的分解和组合任务进行了广泛的研究。他们得出的结论是使用最优分解将会适得其反，因为计算他们消耗的计算时间超过了重组过程中获得的好处。作者报告说，重组操作是最昂贵的，并且给出了例子的执行时间，对于包含少量凹陷的形状执行时间为几秒，对于高度不规则的形状执行时间为20分钟。Avnaim和Boissonnat(1988)讨论了一种基于线性分段的分解重组方法。这些被用来产生平行四边形，这些平行四边形被重新组合以产生NFP。作者提供了一个数学证明，表明该方法可以处理一般情况，并且进一步扩展到允许旋转。该算法的时间复杂度为$O(m^3n^3\log mn)$。

*2.3.2.1.1 凸块*

我们已经讨论过，当涉及到凸形状时，临界多边形的生成是件小事。如果是具有凹面的形状可以被分割为凸块，然后快速凸临界多边形生成技术仍然可以使用。通过将非凸形状分解成凸块从而对几何相交进行简化的工作，在（Avnaim和Boissonnat, 1987; Cuninghame-Green, 1992）中被提出和讨论。这种方法的主要困难是分解和重组算法。许多著名的方法，包括分解成三角块或凸块的方法，都可以应用其中。（Seidal, 1991）提出了一种快速的多边形三角剖分算法，其复杂度为$O(n\log n)$。三角剖分的进一步实现参考（Amenta, 1997）。然而，就目的而言，三角剖分方法产生的子块的数量相比必需的数量超出太多，并且最终会影响生成过程中的计算时间。三角剖分可以被看作凸分解的特殊情况，与其不同的是广义的凸分解算法的目标用少量的凸块来表示多边形。两个关键的方法是：拥有$O(n)$复杂度的次优分解（Hertel 和 Mehlhorm, 1983），和拥有$O(n^3)$复杂度的最优分解（Chazelle 和 Dobkin, 1985）。（Agarwal 等，2002）提出受创建最优分解时固有的计算开销影响，使用次优分解通常更加有效，但是他们也建议寻找一种可能更有效的方法来执行凸覆盖用于替代。一旦任何不规则的多边形被分解成凸块，就可以通过将形状$B$的每个凸块环绕形状$A$的每个凸块来生成临界多边形。这种方法的缺点是凸块的临界多边形可能交叉，在重组它们以构建临界多边形时必须小心。如果原始形状包含孔洞，则会出现特定的困难，因为相交的临界多边形的子块是否定义了可以忽略的孔洞或区域是不明确的。

*2.3.2.1.2. 星形多边形*

Li 和 Milenkovic 将形状分解成凸形和星形多边形。星形多边形具有至少存在一个内部点或者“核心点”的属性，通过“核心点”可以“看到”多边形的整个边界。通过扩展凹面边缘和消除不可见区域可以发现星形多边形拥有一个区域$R_{kernel}$，这个区域可以被定义为在区域内放置一个核心点就可以看到整个多边形边界。而非星形多边形则正好相反，因为没有定义可以放置核心点的区域。因此，就一般性而言，星形多边形介于凸与非凸形状之间。Li 和 Milenkovic 指出星形多边形在“Minkowski和”的运算下是“闭合”的，并且证明了两个星形多边形在“Minkowski和”方法下也会产生星形多边形（Li 和 Milenkovic，1995）。作者没有说明的是他们是否将多个临界多边形区域组合成一个临界多边形实体，或者他们是否在布局生成阶段执行多个临界多边形的相交检测。

*2.3.2.1.3. $\phi$函数*

Stoyan等提出了一种可替代的、有前途的基于“$\phi$-函数"使用的方法。$\phi$-函数定义了成对的标准或者“主要”对象（如：矩形、圆形和凸多边形）之间的数学相交关系。尽管严格来说，$\phi$-函数不是一个基于临界多边形的方法，但是它也被包括在内是因为它已经有了非常有前途的结果。作者进一步发展了他们的工作，通过主要对象的并、交、补来定义非凸多边形的数学相交关系（Stoyan等，2002）。布局生成期间两个形状的主要相交检测是通过比较所有主要对象对的$\phi$-函数来执行的，这些主要对象用于定义形状$A$和形状$B$。$\phi$-函数的第二个好处是，它们是基于主要对象之间的距离函数，因此可以很容易地用来寻找两个复杂对象之间的距离。

#### 2.3.2.2. Minkowski 和

临界多边形的构造可以通过使用“Minkowski 和”（向量加法的一种形式）进行统一，并且由（Stoyan 和 Ponomarenko，1997）首先提出。概念如下：给定两个任意点集$A$和$B$，这两个集合的“Minkowski 和”的定义如下：
$$
A\oplus B=\{a+b:a\in A,b\in B\}
$$
为了生成临界多边形，我们必须使用“Minkowski 差”$A\oplus-B$。这个公式对应输入的两个相反方向的多边形，并且很容易通过简单的向量代数进行展示（Bennel 等，2001）。我们将形状$A$置于逆时针方向，将形状$B$置于顺时针方向，这种在（2.3.1 节）中的简单的仅凸的例子就可以用于验证。我们可以指出，在包含仅凸的形状下，Cuninghame-Green的方法在其最基本的形式中也使用了“Minkowski 差”。

虽然这类方法的非数学的实现细节很少，但是Ghosh和后续的Bennell为临界多边形的区域计算提供了出色的解释和实现的细节。因此，我们请读者参考他们的贡献（Ghosh，1991，1993；Bennell 等，2001）。这种方法的主要缺点是其只能工作在两个形状的凹面之间互不干涉或者不互锁（Ghosh，1991，1993）。（Bennell 等，2001）指出Ghosh的方法将导致“相交边缘的难以处理的缠绕“，这将很难重新组合以形成临界多边形。他们引入了一种方法，用于减少”缠绕边缘“出现的数量，并且给出的实现的细节。他们还报告了文献中五个独立的数据集快速生成时间，每个约为0.3秒。然而，他们也表示这些方法不能处理内部的孔洞，因为很难检测哪些内部的临界多边形的边缘可以被丢弃，哪些形成了内部临界区域。

#### 2.3.2.3. 轨道滑动方法

轨道滑动方法是本文的主要焦点，它涉及使用标准的三角几何来物理滑动一个多边形环绕另一个多边形。临界多边形是通过跟踪环绕时滑动多边形的轨迹点的运动来定义的。（Mahadevan，1984）在其博士论文中第一次详细讨论和实现了轨道方法来产生”包络”。Mahadevan的方法的关键要素是：接触顶点和边缘计算、平移向量的确定和平移长度的计算。相交边缘的计算是用“D函数”的概念来完成的（Konopasek，1981）。Mahadevan修改了“D函数”的检测用于计算接触点，这个计算对于Mahadevan的算法和我们的新方法都是必要的。然后，这个信息被用于根据接触边缘选择平移向量。然后，这个平移向量通过轨道形状的每个顶点进行投影，再利用相交边缘检测来计算平移的距离。将平移向量投影到固定多边形的反方向也很重要。然后，轨道形状沿着平移向量平移最小的距离（从投影和相交检测）。这样确保了两个多边形从不相交，但是总保持接触。该过程持续进行，直到轨道多边形返回到其原始的起始位置。这里，我们就不描述Mahadevan方法的更多细节，因为它的许多特征也在我们的新轨道方法中使用（第3节），并且针对适用情况，我们的与Mahadevan的方法进行了比较，还指出了我们的新方法中的改进。Mahadevan方法的主要缺点是，它不能为包含了孔洞或者一些凹面的形状生成完整的临界多边形。当轨道多边形可以被放置在固定多边形的凹面内，但是凹面具有狭窄的入口时，问题就会出现。在这种情况下，轨道多边形太宽了，将会滑过凹面。在第4节中，我们展示了新的轨道方法如何为所有已知的退化情况生成临界多边形。

